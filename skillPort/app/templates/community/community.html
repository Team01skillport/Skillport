{% extends "base.html" %} {% block title %}コミュニティー{% endblock %} {% block
  content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/community.css') }}">
<div class="reccomended_and_feed">

  <div class="reccomended">
    <h2>おすすめ動画</h2>
    {% for videos in popular_videos %}
    <a class="video_card" href="{{ url_for('lesson_video.video_player', video_id=videos.video_id) }}" aria-label="動画1の詳細を開く">
      <img src="{{url_for('static', filename='media' + videos.thumbnail_path)}}" alt="動画1">
      <h3>{{videos.video_title}}</h3>
      <p class="video_desc">{{videos.video_description_section}}</p>
      <p class="video_upload_user">{{videos.user_name}}</p>
    </a>
    {%endfor%}

  </div>

  <div class="feed">
    <h2>投稿フィード</h2>
    <div class="post-list">
      {% for post in all_posts %}
      <div class="post">
        <div class="user">
          <img class="avatar" src="{{url_for('static', filename='media/user' + post.profile_icon)}}" alt="ユーザーアイコン">
          <a href="{{url_for('auth.view_profile', user_id=post.user_id)}}" class="username">{{post.user_name}}</a>
          </div>
        {% if post.post_media != None %}
        <img src="{{url_for('static', filename='media/posts/' + post.post_media)}}" class="user_media"></img>
        {% endif %}
        <p class="post_text">{{post.post_text}}</p>
       
        
        <p class="upload_date">{{post.post_update_date}}</p>
      </div>
      {% endfor %}
    </div>

    <div class="new-post">
      <form action="{{url_for('community.upload_post')}}" class="upload_post" method="post" enctype="multipart/form-data">
        <div class="input-area">
          <div class="textbox">
            <div class="attachment"></div>
            <input class="text" type="text" name="post_text" placeholder="テキストを追加">
          </div>
          <div class="buttons">
            <label for="upload_media" class="upload-label">＋</label>
            <input 
              type="file" 
              id="upload_media" 
              name="upload_media" 
              accept="image/*" 
              style="display:none;"
            >
            <button class="send" type="submit">▶</button>
          </div>
          <input class="filepick" type="file" accept="image/*,video/*" name="upload_media" hidden>
        </div>
      </form>
     </div> 
  </div>

  <div class="reccomended reccomended--right">
    <h2>おすすめ商品</h2>

    {% for product in recommended_products %}
    <a class="video_card" href="{{ url_for('market.product_detail', product_id=product.product_id) }}" aria-label="{{ product.product_name }}の詳細を開く">
      {% if product.image_path %}
        {% set clean_path = product.image_path %}
        {# パスが '/' で始まる場合に先頭のスラッシュを削除 #}
        {% if clean_path.startswith('/') %}
          {% set clean_path = clean_path[1:] %}
        {% endif %}
        <img src="{{ url_for('static', filename=clean_path) }}" alt="{{ product.product_name }}">
      {% else %}
        {# 画像がない場合のプレースホルダー #}
        <img src="{{ url_for('static', filename='media/product_placeholder.jpg') }}" alt="画像なし">
      {% endif %}
      <h3>{{ product.product_name }}</h3>
      <p>¥{{ product.product_price | int }} | {{ product.product_description | truncate(15) }}</p>
    </a>
    {% else %}
    <p>現在、おすすめの商品はありません。</p>
    {% endfor %}

  </div>
</div>
<div id="editModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="modal__overlay" data-close="true"></div>

  <div class="modal__panel" role="document">
    <header class="modal__header">
      <h3>投稿を編集</h3>
      <button class="modal__close" type="button" aria-label="閉じる" data-close="true">×</button>
    </header>

    <main class="modal__body">
      <label class="modal__label" for="editText">テキスト</label>
      <textarea id="editText" class="modal__textarea" rows="5" placeholder="テキストを入力"></textarea>

      <div class="modal__media">
        <div class="modal__media-top">
          <label class="modal__label">メディア</label>
          <div class="modal__media-actions">
            <button id="btnPickMedia" class="btn btn--ghost" type="button">画像 / 動画を選択</button>
            <button id="btnRemoveMedia" class="btn btn--ghost" type="button">メディアを削除</button>
            <input id="editFile" type="file" accept="image/*,video/*" hidden>
          </div>
        </div>

        <div id="mediaPreview" class="modal__preview">
          </div>
      </div>
    </main>

    <footer class="modal__footer">
      <button class="btn btn--ghost" type="button" data-close="true">キャンセル</button>
      <button id="btnDeletePost" class="btn btn--danger" type="button" style="display:none;">削除</button>
    
      <button id="btnSaveEdit" class="btn btn--primary" type="button" style="display:none;">保存</button>
    
      <button id="btnPostSubmit" class="btn btn--primary" type="button" style="display:none;">投稿</button>
    </footer>
  </div>
</div>

<script src="{{ url_for('static', filename='js/community.js') }}"></script>
</body>
</html>

{% endblock %}