{% extends "base.html" %} {% block title %}{{cat_name}}{% endblock %} {% block
content %}
<head>
  <link
    rel="stylesheet"
    href="{{url_for('static', filename='css/lecture_video.css')}}"
  />
</head>
<body>
  <div class="category-page">
    <div class="category-header">
      <h1>{{cat_name}}</h1>
      <button class="upload-video-btn">動画をアップロード</button>
    </div>

    <div>
      <ul class="item-grid">
        {% for video in category_videos %}
        <li class="item-card">
          <div class="item-image-container">
            <img
              src="{{ url_for('static', filename='media' + video.thumbnail_path)}}"
              alt="画像ここ"
              class="item-image"
            />
            <!-- <div class="play-button">
              <svg viewBox="0 0 24 24" fill="white" width="48px" height="48px">
                <path d="M8 5v14l11-7z" />
              </svg>
            </div> -->
            <p class="image-label">動画コース</p>
          </div>
          <p class="item-title">{{ video.video_title }}</p>
          <p class="item-description">{{ video.video_description_section }}</p>
          <p>{{ video.video_upload_date }}</p>
        </li>
        {% endfor %}
      </ul>
    </div>

    <div class="pagination">
      <a href="#" class="page-link active">1</a>
      <a href="#" class="page-link">2</a>
      <a href="#" class="page-link">3</a>
      <a href="#" class="page-link">4</a>
      <a href="#" class="page-link">5</a>
      <a href="#" class="page-link">6</a>
    </div>
  </div>

  <div id="uploadModal" class="modal">
    <div class="modal__backdrop"></div>
    <div class="modal__card">
      <button class="modal__close" aria-label="Close modal">×</button>
      <div class="modal__content">
        <div class="upload-fields">
          <div class="file-preview-group">
            <div class="file-button-container">
              <label class="file-label file-button thumbnail-button">
                ファイルを選択
                <input
                  type="file"
                  id="videoFile"
                  accept="video/mp4,video/quicktime"
                />
              </label>

              <label class="file-label file-button thumbnail-button">
                サムイルを選択
                <input type="file" id="thumbnailFile" accept="image/*" />
              </label>

              <span id="fileName" class="file-name-display">animation.mp4</span>
            </div>

            <div class="thumbnail-image-preview">
              <img
                src="../static/media/default_thumbnail.jpg"
                alt="プレビュー画像"
              />
            </div>
          </div>

          <label for="videoTitle" class="form-label">タイトル</label>
          <input
            type="text"
            id="videoTitle"
            class="form-input"
            placeholder=""
          />

          <label for="videoDescription" class="form-label">概要欄</label>
          <textarea id="videoDescription" class="form-textarea"></textarea>

          <div class="modal__actions">
            <button class="btn btn--primary">アップ...</button>
            <div class="member-setting">
              <span>メンバー限定</span>
              <span class="dot">•</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // JavaScript 簡單控制邏輯 (處理 Modal 打開與關閉)

    const uploadBtn = document.querySelector(".upload-video-btn");
    const modal = document.getElementById("uploadModal");
    // 由於 Modal 結構已恢復，這裡的查找會成功
    const closeBtn = modal ? modal.querySelector(".modal__close") : null;
    const backdrop = modal ? modal.querySelector(".modal__backdrop") : null;
    const videoFileInput = document.getElementById("videoFile");
    const fileNameDisplay = modal
      ? modal.querySelector(".file-name-display")
      : null;

    function openModal() {
      if (modal) {
        modal.classList.add("is-open");
        document.body.classList.add("modal-open");
      }
    }

    function closeModal() {
      if (modal) {
        modal.classList.remove("is-open");
        document.body.classList.remove("modal-open");
      }
    }

    if (uploadBtn) uploadBtn.addEventListener("click", openModal);
    if (closeBtn) closeBtn.addEventListener("click", closeModal);
    if (backdrop) backdrop.addEventListener("click", closeModal);

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modal && modal.classList.contains("is-open")) {
        closeModal();
      }
    });

    // 更新檔案名稱顯示
    if (videoFileInput && fileNameDisplay) {
      videoFileInput.addEventListener("change", () => {
        if (videoFileInput.files.length > 0) {
          fileNameDisplay.textContent = videoFileInput.files[0].name;
        } else {
          fileNameDisplay.textContent = "animation.mp4";
        }
      });
    }
  </script>
</body>
{% endblock %}
