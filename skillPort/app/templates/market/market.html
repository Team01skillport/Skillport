{% extends "base.html" %} {% block title %}ãƒãƒ¼ã‚±ãƒƒãƒˆ{% endblock %} {% block
content %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/market.css') }}"
/>
<main class="main-content">
  <div class="main-container">
    <div class="page-header">
      <h2 class="page-title">ãƒãƒ¼ã‚±ãƒƒãƒˆ</h2>
      <div class="search-bar">
        <form action="{{ url_for('search.market_search')}}">
          <button type="submit" class="search-icon">ğŸ”</button>
          <input
            type="text"
            name="market_search"
            placeholder="æ¤œç´¢ãƒãƒ¼"
            class="product-search"
          />
        </form>
      </div>
      {% if 'user_id' in session %}
      <div class="action-buttons">
        <a
          href="{{ url_for('market.manage_products_page') }}"
          class="btn btn-green"
        >
          <span class="btn-icon">â—</span> å‡ºå“ç®¡ç†
        </a>
        <button class="btn btn-yellow">
          <span class="btn-icon">â—</span> è³¼å…¥ç®¡ç†
        </button>
      </div>
      {% else %}
      <div class="action-buttons-placeholder"></div>
      {% endif %}
    </div>

    <div class="content-wrapper">
      
      <form action="{{ url_for('market.market_top') }}" method="GET" class="sidebar" data-categories="{{ all_categories | tojson | safe }}">
        <aside>
          <button type="submit" class="filter-btn active">æ›´æ–°</button>

          <div class="sidebar-title">
            <span>çµã‚Šè¾¼ã¿</span>
          </div>

          <div class="filter-section" id="categoryFilter">
            <button type="button" class="filter-item toggle-filter-btn">
              <span>ã‚«ãƒ†ã‚´ãƒªãƒ¼</span><span class="arrow">ï¼</span>
            </button>
            <div class="filter-content" id="categoryListContainer" style="display: none">
              </div>
          </div>
          <div class="filter-section" id="statusFilter">
            <button type="button" class="filter-item toggle-filter-btn">
              <span>è²©å£²çŠ¶æ³</span><span class="arrow">ï¼</span>
            </button>
            <div class="filter-content" style="display: none">
              <div class="filter-checkbox-group">
                <label><input type="checkbox" name="sale_status" value="on_sale" /> è²©å£²ä¸­</label>
                <label><input type="checkbox" name="sale_status" value="sold_out" /> å£²ã‚Šåˆ‡ã‚Œ</label>
              </div>
            </div>
          </div>
          <div class="filter-section" id="sellerFilter">
            <button type="button" class="filter-item toggle-filter-btn">
              <span>å‡ºå“è€…</span><span class="arrow">ï¼</span>
            </button>
            <div class="filter-content" style="display: none">
              <input type="text" name="seller_name" class="filter-search-input" placeholder="å‡ºå“è€…åã§æ¤œç´¢...">
            </div>
          </div>

          <div class="filter-section" id="conditionFilter">
            <button type="button" class="filter-item toggle-filter-btn">
              <span>å•†å“ã®çŠ¶æ…‹</span><span class="arrow">ï¼</span>
            </button>
            <div class="filter-content" style="display: none">
              <div class="filter-checkbox-group">
                <label><input type="checkbox" name="condition" value="new" /> æ–°å“</label>
                <label><input type="checkbox" name="condition" value="used" /> ä¸­å¤</label>
              </div>
            </div>
          </div>
          
          <div class="filter-section" id="priceFilter">
            <button type="button" class="filter-item toggle-filter-btn">
              <span>ä¾¡æ ¼</span><span class="arrow">ï¼</span>
            </button>
            <div class="filter-content price-filter-content" style="display: none">
              <div class="price-slider-container">
                  <input type="range" id="priceRange" class="price-slider" min="100" max="100000" value="50000" step="100">
                  <div class="price-display">Â¥ <span id="priceValue">50,000</span></div>
              </div>
              <div class="price-inputs">
                <input type="number" name="min_price" placeholder="Â¥ Min" class="price-input" min="0" />
                <span>-</span>
                <input type="number" name="max_price" placeholder="Â¥ Max" class="price-input" min="0" />
              </div>
              <!-- <button type="button" class="btn-apply-price">é©ç”¨</button> -->
            </div>
          </div>
          </aside>
      </form>
      <div class="products-area">
        <div class="products-header"></div>

        <div class="product-grid" id="productGrid">
          {% for product in all_products %}
          <a
            href="{{url_for('market.product_detail', product_id=product.product_id)}}"
            ><div class="product-container">
              {% if product.image_path %}
                <img src="{{ url_for('static', filename=product.image_path[1:]) }}" alt="{{product.product_name}}" style="width:100%; height: 150px; object-fit: cover;">
              {% else %}
                <div style="width:100%; height: 150px; background-color: #f0f0f0; display:flex; align-items:center; justify-content:center; color: #aaa;">ç”»åƒã“ã“</div>
              {% endif %}
              
              <h3>{{product.product_name}}</h3>
              <p>
                {{ product.product_price | int | tojson | safe | replace('"', '') }}å†† ï½œ {{product.product_condition}}
              </p>
              <p>{{product.listing_date.strftime('%Y-%m-%d')}}</p>
            </div></a
          >
          {% endfor %}
          </div>

        </div>
    </div>
  </div>
</main>
{% endblock %}
{% block scripts %}
  <script src="{{ url_for('static', filename='js/market.js') }}" defer></script>
{% endblock %}