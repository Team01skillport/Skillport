{% extends "base.html" %} {% block title %}マーケット{% endblock %} {% block
content %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/market.css') }}"
/>
<main class="main-content">
  <div class="main-container">
    <div class="page-header">
      <h2 class="page-title">マーケット</h2>
      <div class="search-bar">
        <form action="{{ url_for('market.market_top')}}" method="GET">
          <button type="submit" class="search-icon">
            <img src="../../static/media/search.png" alt="" />
          </button>
          <input
            type="text"
            name="keyword"
            placeholder="商品名で検索..."
            class="product-search"
            value="{{ request.args.get('keyword', '') }}"
          />
        </form>
      </div>
      {% if 'user_id' in session %}
      <div class="action-buttons">
        <a
          href="{{ url_for('market.manage_products_page') }}"
          class="btn btn-green"
        >
          <span class="btn-icon">●</span> 出品管理
        </a>
        <a
          href="{{ url_for('market.purchase_history_page') }}"
          class="btn btn-yellow"
        >
          <span class="btn-icon">●</span> 購入履歴
        </a>
      </div>
      {% else %}
      <div class="action-buttons-placeholder"></div>
      {% endif %}
    </div>

    <div class="content-wrapper">
      <form
        action="{{ url_for('market.market_top') }}"
        method="GET"
        class="sidebar"
      >
        <aside>
          <button type="submit" class="filter-btn active">更新</button>

          <div class="sidebar-title">
            <span>絞り込み</span>
          </div>

          <div class="filter-section" id="categoryFilter">
            <button type="button" class="filter-item toggle-filter-btn">
              <span>カテゴリー</span><span class="arrow">＞</span>
            </button>

            <div class="filter-content" id="categoryListContainer">
              <div class="filter-checkbox-group">
                {% if all_categories %} {% for cat in all_categories %}
                <label>
                  <input type="checkbox" name="category" value="{{ cat.id }}" />
                  {{ cat.name }}
                </label>
                {% endfor %} {% else %}
                <p style="font-size: 13px; color: #777; padding-left: 5px">
                  カテゴリーが見つかりません。
                </p>
                {% endif %}
              </div>
            </div>
          </div>
          <div class="filter-section" id="statusFilter">
            <button type="button" class="filter-item toggle-filter-btn">
              <span>販売状況</span><span class="arrow">＞</span>
            </button>
            <div class="filter-content">
              <div class="filter-checkbox-group">
                <label
                  ><input type="checkbox" name="sale_status" value="on_sale" />
                  販売中</label
                >
                <label
                  ><input type="checkbox" name="sale_status" value="sold_out" />
                  売り切れ</label
                >
              </div>
            </div>
          </div>
          <div class="filter-section" id="sellerFilter">
            <button type="button" class="filter-item toggle-filter-btn">
              <span>出品者</span><span class="arrow">＞</span>
            </button>
            <div class="filter-content">
              <input
                type="text"
                name="seller_name"
                class="filter-search-input"
                placeholder="出品者名で検索..."
              />
            </div>
          </div>

          <div class="filter-section" id="conditionFilter">
            <button type="button" class="filter-item toggle-filter-btn">
              <span>商品の状態</span><span class="arrow">＞</span>
            </button>
            <div class="filter-content">
              <div class="filter-checkbox-group">
                <label
                  ><input type="checkbox" name="condition" value="new" />
                  新品</label
                >
                <label
                  ><input type="checkbox" name="condition" value="used" />
                  中古</label
                >
              </div>
            </div>
          </div>

          <div class="filter-section" id="priceFilter">
            <button type="button" class="filter-item toggle-filter-btn">
              <span>価格</span><span class="arrow">＞</span>
            </button>
            <div class="filter-content price-filter-content">
              <div class="price-slider-container">
                <input
                  type="range"
                  id="priceRange"
                  class="price-slider"
                  min="100"
                  max="100000"
                  value="50000"
                  step="100"
                />
                <div class="price-display">
                  ¥ <span id="priceValue">50,000</span>
                </div>
              </div>
              <div class="price-inputs">
                <input
                  type="number"
                  name="min_price"
                  placeholder="¥ Min"
                  class="price-input"
                  min="0"
                />
                <span>-</span>
                <input
                  type="number"
                  name="max_price"
                  placeholder="¥ Max"
                  class="price-input"
                  min="0"
                />
              </div>
            </div>
          </div>
        </aside>
      </form>
      <div class="products-area">
        <div class="products-header"></div>

        <div class="product-grid" id="productGrid">
          {% for product in all_products %}
          <a
            href="{{url_for('market.product_detail', product_id=product.product_id)}}"
            ><div class="product-container">
              {% if product.image_path %}
              {% set clean_path = product.image_path | replace('\'', '') %}
              {% if clean_path.startswith('/') %}
                {% set clean_path = clean_path[1:] %}
              {% endif %}
              <img
                src="{{ url_for('static', filename=clean_path) }}"
                alt="{{product.product_name}}"
                style="width: 100%; height: 150px; object-fit: cover"
              />
              {% else %}
              <div
                style="
                  width: 100%;
                  height: 150px;
                  background-color: #f0f0f0;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  color: #aaa;
                "
              >
                画像ここ
              </div>
              {% endif %}
              <div class="product-title">{{product.product_name}}</div>
              <p>
                ￥{{ product.product_price | int | tojson | safe | replace('"',
                '') }} ｜ {{product.product_condition}}
              </p>
              <p class="listing_date">{{product.listing_date.date()}}</p>
            </div></a
          >
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</main>
{% endblock %} {% block scripts %}
<script src="{{ url_for('static', filename='js/market.js') }}" defer></script>
{% endblock %}