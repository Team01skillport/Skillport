{% extends "base.html" %} {% block title %}{{ info.product_name |
default('商品詳細', true) }}{% endblock %} {% block styles %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/product_detail.css') }}"
/>
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/popup_report.css') }}"
/>
<style>
  /* [新增] 为没有图片的占位符添加样式 */
  .dummy-main-image {
    width: 100%;
    height: var(--main-img, 440px);
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f8f8;
    border: 1.5px solid #ccc;
    border-radius: 10px;
    font-size: 1.5rem;
    color: #aaa;
    flex-direction: column;
  }
  
  /* [新增] 评论表单的样式 */
  .comment-form {
    margin-bottom: 20px;
  }
  .comment-form textarea {
    width: 100%;
    min-height: 80px;
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 10px;
    font-size: 14px;
    margin-bottom: 10px;
  }
  .comment-form .comment-btn {
    width: 100%; /* 按钮宽度调整为100% */
  }
  
  /* [新增] 评论列表的样式 */
  .comment-box li p {
    margin: 0; /* 移除 <p> 标签的默认边距 */
  }
  .comment-box li strong {
    font-size: 13px; /* 用户名稍小 */
  }
  
</style>
{% endblock %} {% block content %}
<div class="page-wrap">
  <main class="product-section">
    <div class="image-area">
      <div class="thumbnails">
        {% if info.image_path %}
        {% set clean_path = info.image_path %}
        {% if clean_path.startswith('/') %}
          {% set clean_path = clean_path[1:] %}
        {% endif %}
        <img
          src="{{ url_for('static', filename=clean_path) }}"
          class="thumb active"
          alt="サムネイル1"
        />
        {% endif %} {% for img in other_images %}
        {% set clean_path_other = img.image_path %}
        {% if clean_path_other.startswith('/') %}
          {% set clean_path_other = clean_path_other[1:] %}
        {% endif %}
        <img
          src="{{ url_for('static', filename=clean_path_other) }}"
          class="thumb"
          alt="サムネイル{{ loop.index + 1 }}"
        />
        {% endfor %}
      </div>
      <div class="main-image">
        {% if info.image_path %}
        {% set clean_path = info.image_path %}
        {% if clean_path.startswith('/') %}
          {% set clean_path = clean_path[1:] %}
        {% endif %}
        <img
          id="mainImage"
          src="{{ url_for('static', filename=clean_path) }}"
          alt="メイン商品画像"
        />
        {% else %}
        <div class="dummy-main-image">
          <span>?</span>
          <p style="font-size: 1rem; margin-top: 10px">画像がありません</p>
        </div>
        {% endif %}
      </div>
    </div>
    <div class="info-area">
      <h1>{{info.product_name}}</h1>
      <p class="price">¥{{info.product_price}}(税込)</p>

      <div class="action-buttons">
        <input type="button" value="♡ お気に入り"  id="favorite_button" data-product-id="{{info.product_id}}" class="btn">
        <a href="#" class="btn" id="reportBtn">通報</a>
      </div>

      <a
        href="{{ url_for('market.checkout_page', product_id=info.product_id) }}"
        class="buy-btn"
        >購入</a
      >

      <div class="desc">
        <h2>商品の説明</h2>
        <p>{{info.product_description}}</p>
      </div>

      <div class="detail">
        <h2>商品の情報</h2>
        <ul>
          <li>商品の状態：<b>{{info.product_condition}}</b></li>
          <li>配送元の地域：<b>{{info.shipping_area}}</b></li>
        </ul>
      </div>
    </div>
  </main>

  <section class="bottom-section">
    <div class="comment-box">
      
      <div class="comment-form" data-product-id="{{ info.product_id }}">
        <h3>コメント投稿</h3>
        <textarea id="commentInput" placeholder="商品についての質問やコメントを入力..." rows="4"></textarea>
        <button id="commentSubmitBtn" class="comment-btn">コメント投稿</button>
      </div>

      <h3>コメント一覧</h3>
      
      <ul id="commentList">
        {% if comments %}
          {% for comment in comments %}
          <li>
            {% if comment.profile_icon and comment.profile_icon != '/icons/default_icon.png' %}
              <img src="{{ url_for('static', filename=comment.profile_icon[1:]) }}" alt="icon">
            {% else %}
              <img src="{{ url_for('static', filename='media/profile_icon.png') }}" alt="icon">
            {% endif %}
            <div class="bubble">
              <strong>{{ comment.user_name }}</strong>
              <p>{{ comment.comment_text }}</p>
              </div>
          </li>
          {% endfor %}
        {% else %}
          <li id="noCommentsYet">まだコメントがありません。</li>
        {% endif %}
      </ul>
    </div>
    
    <div class="seller-box">
      <h3>出品者</h3>
      <div class="seller-info">
        {% if info.seller_icon and info.seller_icon != '/icons/default_icon.png' %}
        <img
          src="{{ url_for('static', filename=info.seller_icon[1:]) }}"
          alt="出品者アイコン"
        />
        {% else %}
        <img
          src="{{ url_for('static', filename='media/profile_icon.png') }}"
          alt="デフォルトアイコン"
        />
        {% endif %}
        <div class="text"> <h4>
            {% if uploader_id %}
            <a href="{{url_for('auth.view_profile', user_id=uploader_id)}}">
              {{ info.seller_name }}
            </a>
            {% else %}
            {{ info.seller_name }}
            {% endif %}
          </h4>
        </div> 
        </div>
      </div>
    </div>
  </section>
  </div>

<div id="reportModal" class="modal hidden">
  <div class="modal-content">
    <h2>通報</h2>
    <form id="reportForm">
      <label
        ><input type="radio" name="reason" value="不適切" />
        公序良俗に反する内容を含む</label
      ><br />
      <label
        ><input type="radio" name="reason" value="違法商品" />
        違法・禁止商品の出品</label
      ><br />
      <label
        ><input type="radio" name="reason" value="著作権侵害" />
        著作権・商標権の侵害</label
      ><br />
      <label
        ><input type="radio" name="reason" value="虚偽" /> 商品説明が虚偽</label
      ><br />
      <label><input type="radio" name="reason" value="その他" /> その他</label
      ><br />
      <textarea
        name="detail"
        rows="4"
        placeholder="詳細内容を入力してください"
      ></textarea>
      <div class="modal-buttons">
        <button type="button" id="closeModal">キャンセル</button>
        <button type="submit" id="submitReport">報告</button>
      </div>
    </form>
  </div>
</div>
{% endblock %} {% block scripts %}
<script
  src="{{ url_for('static', filename='js/product_detail.js') }}"
  defer
></script>
<script
  src="{{ url_for('static', filename='js/popup_report.js') }}"
  defer
></script>
{% endblock %}