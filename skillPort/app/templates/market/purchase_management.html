{% extends "base.html" %}

{% block title %}購入履歴{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/product_management.css') }}">
  <style>
    .no-products-message {
      grid-column: 1 / -1;
      text-align: center;
      padding: 60px 20px;
      background-color: #f9f9f9;
      border-radius: 12px;
      border: 1px dashed #ddd;
      margin-top: 20px;
      color: #555;
    }
    .no-products-message p {
      margin: 10px 0;
      font-size: 1rem;
    }
    .no-products-message p.lead {
      font-size: 1.2rem;
      font-weight: 600;
      color: #333;
    }
    .card .ops {
        font-size: 0.9rem;
        padding: 0 4px;
    }
    .card .price {
        font-weight: bold;
        color: #333;
    }
    .card .shipping-status {
        color: #0d6efd;
        font-weight: 600;
    }
    .dummy-thumb {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        background-color: #f0f2f5;
        color: #9ca3af;
        text-align: center;
    }
    .dummy-thumb span { font-size: 2rem; font-weight: bold; }
    .dummy-thumb p { font-size: 0.8rem; margin-top: 8px; padding: 0 10px; }
  </style>
{% endblock %}

{% block content %}
<main class="pmain">
  <div class="pcontainer">
    <h2 class="page-title">購入履歴</h2>

    <section class="grid">
      
      {% if my_orders %}
        {% for order in my_orders %}
        <article class="card">
          <a href="{{ url_for('market.product_detail', product_id=order.product_id) }}" style="text-decoration: none; color: inherit;">
            <div class="thumb">
              {% if order.image_path %}
                <img src="{{ url_for('static', filename=order.image_path[1:]) }}" alt="{{ order.product_name }}">
              {% else %}
                <div class="dummy-thumb">
                  <span>?</span>
                  <p>{{ order.product_name | truncate(20) }}</p>
                </div>
              {% endif %}
            </div>
            <div class="ops">
              <span class="price">¥{{ order.total_amount }}</span>
              <span class="shipping-status">{{ order.shipping_status }}</span>
            </div>
            <div class="ops" style="margin-top: 4px;">
              <span style="color: #666;">{{ order.product_name | truncate(25) }}</span>
            </div>
          </a>
        </article>
        {% endfor %}
        
      {% else %}
        <div class="no-products-message">
          <p class="lead">購入履歴はまだありません。</p>
          <p>マーケットでお気に入りの商品を見つけましょう。</p>
        </div>
      {% endif %}

    </section>
  </div>
</main>
{% endblock %}