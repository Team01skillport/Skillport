{% extends "base.html" %} 
{% block title %} è³¼å…¥æ‰‹ç¶šã{% endblock %} 

{% block styles %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/checkout.css') }}"
/>
{% endblock %} 

{% block content %}
<main class="page">
  <h1 class="page-title">è³¼å…¥æ‰‹ç¶šã</h1>
  <div class="grid">
    <section class="left">
      
      <div class="product-row">
        {% if product.image_path %}
          {% set clean_path = product.image_path %}
          {% if clean_path.startswith('/') %}
            {% set clean_path = clean_path[1:] %}
          {% endif %}
          <img src="{{ url_for('static', filename=clean_path) }}" alt="{{ product.product_name }}" class="thumb">
        {% else %}
          <img src="{{ url_for('static', filename='media/default_product_image.png') }}" alt="å•†å“ç”»åƒ" class="thumb">
        {% endif %}
        <div class="meta">
          <p class="title">{{ product.product_name }}</p>
          <p class="price">Â¥{{ product.product_price }}(ç¨è¾¼)</p>
        </div>
      </div>

      <div class="block">
        <div class="block-head">
          <h2>æ”¯æ‰•ã„æ–¹æ³•</h2>
          {% if payment_methods %}
          <button class="link-edit small" type="button" id="btnEditPayment">
            å¤‰æ›´ãƒ»è¿½åŠ 
          </button>
          {% endif %}
        </div>

        {% if payment_methods %}
          <div class="select-wrap">
            <select id="paymentSelect" name="payment_method_id" aria-label="æ”¯æ‰•ã„æ–¹æ³•ã‚’é¸æŠ">
              {% for payment in payment_methods %}
                {% if payment.account_type == 'ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ' and payment.card_num != '0000000000000000' %}
                  <option value="{{ payment.card_num }}">
                    ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ (**** {{ payment.card_num[-4:] }})
                  </option>
                {% elif payment.account_type != 'ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ' and payment.bank_name %}
                  <option value="{{ payment.bank_account_num }}">
                    {{ payment.bank_name }} ({{ payment.account_type }})
                  </option>
                {% endif %}
              {% endfor %}
            </select>
            <span class="select-icon">â–¾</span>
          </div>
        {% else %}
          <div class="payment-add-buttons">
            <button type="button" class="btn-add-payment" id="btnOpenModalCredit">
              + ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ 
            </button>
            <button type="button" class="btn-add-payment" id="btnOpenModalBank">
              + éŠ€è¡Œå£åº§ã‚’è¿½åŠ 
            </button>
          </div>
          <select id="paymentSelect" name="payment_method_id" class="hidden-select">
            <option value="" disabled selected id="noPaymentOption">æ”¯æ‰•ã„æ–¹æ³•ãŒã‚ã‚Šã¾ã›ã‚“</option>
          </select>
        {% endif %}
      </div>
      <div class="block">
        <div class="block-head">
          <h2>é…é€å…ˆ</h2>
          <button class="link-edit small" type="button" id="btnEditAddress">
            å¤‰æ›´
          </button>
        </div>
        <address class="address" id="shippingAddressDisplay">
          {% if address and address.zip_code %}
            {{ address.last_name | default('', true) }} {{ address.first_name | default('', true) }}
            ï¼ˆ{{ address.last_name_katakana | default('', true) }} {{ address.first_name_katakana | default('', true) }}ï¼‰<br />
            ã€’{{ address.zip_code }}<br />
            {{ address.prefecture | default('', true) }}
            {{ address.address1 | default('', true) }}<br />
            {{ address.address2 | default('', true) }}
          {% else %}
            <strong>é…é€å…ˆä½æ‰€ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</strong><br />
            <span class="link-edit" style="cursor: pointer;" id="btnAddAddress">
              ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä½æ‰€ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚
            </span>
          {% endif %}
        </address>
      </div>
    </section>

    <aside class="right">
      <div class="summary">
        <div class="row">
          <span>å•†å“ä»£é‡‘</span>
          <strong id="sumSubtotal">Â¥{{ product.product_price }}</strong>
        </div>
        <div class="row">
          <span>é€æ–™</span>
          <strong id="sumShipping">ç„¡æ–™</strong>
        </div>
        <div class="row total">
          <span>æ”¯æ‰•ã„é‡‘é¡</span>
          <strong id="sumTotal">Â¥{{ product.product_price }}</strong>
        </div>
        <div class="row">
          <span>æ”¯æ‰•ã„æ–¹æ³•</span>
          <strong id="sumPayment">ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰</strong>
        </div>
      </div>
      <button class="btn-primary" id="btnPurchase">è³¼å…¥ã™ã‚‹</button>
    </aside>
  </div>
</main>

<div id="addressModal" class="modal">
  <div class="modal-content">
    <h2 class="modal-title">é…é€å…ˆã®ç·¨é›†</h2>
    <form id="addressForm" class="modal-form">
      <label for="modalZipCode">éƒµä¾¿ç•ªå· (ãƒã‚¤ãƒ•ãƒ³ãªã—)</label>
      <input type="text" id="modalZipCode" name="zip_code" value="{{ address.zip_code | default('', true) }}" required>
      <label for="modalPrefecture">éƒ½é“åºœçœŒ</label>
      <input type="text" id="modalPrefecture" name="prefecture" value="{{ address.prefecture | default('', true) }}" required>
      <label for="modalAddress1">å¸‚åŒºç”ºæ‘ãƒ»ç•ªåœ°</label>
      <input type="text" id="modalAddress1" name="address1" value="{{ address.address1 | default('', true) }}" required>
      <label for="modalAddress2">å»ºç‰©åãƒ»éƒ¨å±‹ç•ªå· (ä»»æ„)</label>
      <input type="text" id="modalAddress2" name="address2" value="{{ address.address2 | default('', true) }}">
      <div class="modal-buttons">
        <button type="button" class="apple-ui-button apple-ui-secondary" id="btnCancelAddress">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button type="submit" class="apple-ui-button apple-ui-primary">ä¿å­˜ã™ã‚‹</button>
      </div>
    </form>
  </div>
</div>

<div id="paymentModal" class="modal">
  <div class="modal-content">
    <h2 class="modal-title">æ”¯æ‰•ã„æ–¹æ³•ã®è¿½åŠ </h2>
    <form id="paymentForm" class="modal-form">
      
      <div class="payment-type-selector">
        <label class="payment-type-option active" id="labelCredit">
          <input type="radio" name="payment_type" value="credit" checked>
          <span class="icon">ğŸ’³</span>
          <span>ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰</span>
        </label>
        <label class="payment-type-option" id="labelBank">
          <input type="radio" name="payment_type" value="bank">
          <span class="icon">ğŸ¦</span>
          <span>éŠ€è¡Œå£åº§</span>
        </label>
      </div>
      
      <div id="creditCardForm" class="active">
          <label for="card_num">ã‚«ãƒ¼ãƒ‰ç•ªå·</label>
          <input type="text" id="card_num" name="card_num" placeholder="XXXX XXXX XXXX XXXX" maxlength="19">
          <label for="card_name">åç¾©äºº (TARO YAMADA)</label>
          <input type="text" id="card_name" name="card_name" placeholder="TARO YAMADA">
          <label for="card_expiration">æœ‰åŠ¹æœŸé™ (MM/YY)</label>
          <input type="text" id="card_expiration" name="card_expiration" placeholder="MM/YY" maxlength="5">
      </div>

      <div id="bankAccountForm">
          <label for="bank_name">éŠ€è¡Œå</label>
          <select id="bank_name" name="bank_name">
              <option value="" disabled selected>éŠ€è¡Œã‚’é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="ä¸‰è±ï¼µï¼¦ï¼ªéŠ€è¡Œ">ä¸‰è±ï¼µï¼¦ï¼ªéŠ€è¡Œ</option>
              <option value="ä¸‰äº•ä½å‹éŠ€è¡Œ">ä¸‰äº•ä½å‹éŠ€è¡Œ</option>
              <option value="ã¿ãšã»éŠ€è¡Œ">ã¿ãšã»éŠ€è¡Œ</option>
              <option value="ã‚ŠããªéŠ€è¡Œ">ã‚ŠããªéŠ€è¡Œ</option>
              <option value="ã‚†ã†ã¡ã‚‡éŠ€è¡Œ">ã‚†ã†ã¡ã‚‡éŠ€è¡Œ</option>
              <option value="æ¥½å¤©éŠ€è¡Œ">æ¥½å¤©éŠ€è¡Œ</option>
              <option value="PayPayéŠ€è¡Œ">PayPayéŠ€è¡Œ</option>
              <option value="ãã®ä»–">ãã®ä»–ï¼ˆãã®ä»–éŠ€è¡Œï¼‰</option>
          </select>
          <label for="account_type">å£åº§ç¨®åˆ¥</label>
          <select id="account_type" name="account_type">
              <option value="æ™®é€š" selected>æ™®é€š</option>
              <option value="å½“åº§">å½“åº§</option>
          </select>
          <label for="bank_account_num">å£åº§ç•ªå·</label>
          <input type="text" id="bank_account_num" name="bank_account_num" placeholder="7æ¡ä»¥å†…ã®å£åº§ç•ªå· (æ•°å­—ã®ã¿)">
          <label for="acc_holder_name">å£åº§åç¾©äºº (ã‚«ã‚¿ã‚«ãƒŠ)</label>
          <input type="text" id="acc_holder_name" name="acc_holder_name" placeholder="ä¾‹: ãƒ¤ãƒãƒ€ã‚¿ãƒ­ã‚¦ (å…¨è§’ã‚«ã‚¿ã‚«ãƒŠ)"> 
      </div>

      <div class="modal-buttons">
        <button type="button" class="apple-ui-button apple-ui-secondary" id="btnCancelPayment">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button type="submit" class="apple-ui-button apple-ui-primary">ä¿å­˜ã™ã‚‹</button>
      </div>
    </form>
  </div>
</div>
{% endblock %} 

{% block scripts %}
<script src="{{ url_for('static', filename='js/checkout.js') }}" defer></script>
{% endblock %}